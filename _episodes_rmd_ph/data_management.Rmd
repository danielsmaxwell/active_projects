---
title: "Data Management in R (Instructional Worksheet)"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<script src="hideOutput.js"></script>

<link rel="stylesheet" type="text/css" href="fold.css">

#\textcolor{blue}{1.1} Packages and Libraries

The functions in R are organized in packages or libraries. The commonly used packages are preinstalled within R. However, if you need to use more specialized packages, you will need to install and then load the package before you can use functions available in that package.  

Packages are installed and loaded in the Packages tab in the bottom right corner or through the dropdown menu at the top of the screen (Tools -> Install Packages).  

If a package is already installed on your computer, it will be listed in this tab. To load this package so you can use it, hit the checkmark next to the name of the package.  

If a package is not installed, click the 'Install' button at the top of the tab, type in the name of the package, and click 'Install'. Once it has been installed click the checkmark next to the name to load it.  

Installed packages can also be loaded from the command line or within a script using the library function. 

```{r eval=FALSE}

library(MASS) #Load previously installed package 'popbio'
```

#\textcolor{blue}{1.2} Importing .CSV and .TXT files

R can import data stored in a wide variety of file types (including Excel files), but the file type you'll probably encounter most frequently has a .csv or .txt extension. The .csv extension stands for "comma-separated values."

> ### Note: A CSV file is recommended for R. 

A .txt file, on the other hand, is a simple text file created with a program like Notepad. Instead of commas, text files often use hidden characters, the tab and newline characters for example, to separate values.

## Using the Environment tab

1. In the Environment tab, in the top right corner click on 'Import Dataset', and then 'From Text File...'.
2. Choose the file that you want to import.
3. Choose a name for the data - enter into the 'Name' blank. (This name cannot contain any spaces)
4. Choose yes or no depending on whether or not the file has a Heading (column names)
5. Choose the separator, decimal, quote, and na.strings depending on your data
6. Click import  

## Read Commands

The following command can be typed into the console to import the data.

For a CSV file:
```{r eval=FALSE}
data <- read.csv("data.csv", header=TRUE)
```

For a text file:
```{r eval=FALSE}
data <- read.table("data.txt", header = TRUE, sep=" ")
```

The first argument is the file name (found within the working directory set earlier).  

The second argument, header, refers to whether or not the column names are listed in the first line of the file, TRUE is used for yes, FALSE for no.  

The third argument, sep, refers to what is separating the values. A CSV uses commas, but a text document could use semicolons, colons, etc.  

#\textcolor{blue}{1.3} Matrices and Data Frames

## Matrices

Matrices are two-dimensional, for example a 4 x 5 matrix has 4 rows and 5 columns. All values within the matrix must be of the same type, i.e., all numeric or all characters

```{r}
mymatrix <- matrix(1:4, nrow=2, ncol=2)
mymatrix
```

The values of a matrix are accessed using their position, like for vectors, but for matrices it is necessary to designate the row and column.

```{r}
mymatrix[1,2]  # The value in row 1 column 2
mymatrix[2,1]  # The value in row 2 column 1
mymatrix[,2]   # The values for all rows, column 2
mymatrix[1,]   # The values for row 1, and all columns
mymatrix[1:2,] # The values from row 1 to 2, and all columns
```

Change the value in row 1 column 2 to 0
```{r}
mymatrix[1,2] <- 0
mymatrix[1,2]
```

## Data Frames

Data frames are the workhorses of R and are a more general form of matrix. The values do not have to be of the same type, but instead one data frame can contain numbers, characters, and factors.

```{r}
d <- c(1,2,3,4)
e <- c("red", "white", "red", "blue")
f <- factor(c("high", "low", "high", "high"))

mydata <- data.frame(d,e,f)

names(mydata) <- c("ID", "Color", "Level")

mydata
```

The values of a data frame can be accessed in a variety of ways.

```{r}
mydata[1]    # Calls column 1
mydata["ID"] # Another way to access column 1 - using the column name
mydata$ID    # Last way to access column 1 - also using the column name  
mydata[1,]   # Access the first row
```

## Useful Functions for Data Sets

R has a lot of built-in datasets that we will use throughout the course. If you use *data()* you can see a list of all available datasets. In this case we will use the *sleep* dataset, which contains data on the effect of two soporific drugs (increase in hours of sleep compared to control) on 10 patients. If you type *help(sleep)* you can read more information about this dataset. 

```{r}
str(sleep) # Structure of the dataframe
```
```{r eval=FALSE}
sleep       # Displays all the data
head(sleep)  # Displays first 6 rows of data
tail(sleep)  # Displays last 6 rows of data
```
```{r}
nrow(sleep)  # Number of rows
ncol(sleep)      # Number of columns
names(sleep) # Column names

length(sleep$extra) # Number of data points in that column
```


#\textcolor{blue}{1.4} Subsetting Data

Sometimes if we have a large dataset for multiple categories, we might want to subset it into smaller datasets for analysis.  

For example, let's look at the sleep dataset again, which gives us the effect of two soporific drugs.

We can create separate datasets for each of the drugs.  

```{r eval=FALSE}
# This creates a new dataframe called 'drug1' which contains all columns of data 
# for just the first drug
drug1 <- subset(sleep, sleep$group == "1")

# This creates a new dataframe called 'drug2' which contains all columns of data 
# for just the second drug
drug2 <- subset(sleep, sleep$group == "2")
```

We can also subset based on criteria - in this case such as incrase in hours of sleep.

```{r eval=FALSE}
# This dataframe only contains the data on patients that  
# had an increase in hours of sleep compared to the control
sleep2 <- subset(sleep, sleep$extra > 0)
```

#\textcolor{blue}{1.5} Merging Data Frames

Sometimes you need to merge two dataframes using a column (variable) that is shared between them.  

Let's create two small dataframes and then we can merge them based on the shared column.

```{r}
dataA <- data.frame(year = seq(2000,2005), v1 = c(1,5,3,4,2,2))
dataB <- data.frame(year = seq(2000,2005), v2 = c(2,4,3,5,5,5))
```

Combine the two dataframes using the *merge()* function.

```{r}
comb_data <- merge(dataA, dataB, by = "year")
```

And finally, take a look at the final product.

```{r}
comb_data
```

\newpage
#\textcolor{blue}{1.6} Problem Set

1. Open the 'survey' dataset, which is in the MASS package, and read the help file to learn about the data in this dataset. Hint: You will have to install the MASS package and load it first, then open the dataset using data(survey).

2. Display the structure of the survey data frame. What is included? How many observations and how many variables? What are the variable names?  

3. What are three ways to display the data in column 1 of the survey data frame?  

4. How do you access the $5th$ row of data in the survey data frame?  

5. Display the first $6$ rows of the survey data frame.  

6. Display the last $6$ rows of the survey data frame.  

7. How many rows are in the survey data frame?  

8. How many columns are in the survey data frame?  

9. Look at the Exer column in the survey data frame. How many options are there? Create a new data frame (called freq) that contains the data only for students those who frequently exercise. 

10. Create a new data frame called HeightTall that only contains the data when the student height in centimeters is over $180$. How many rows are in this new data frame?  



After you have completed the problem set, click the Code button to see the solution.

<div class="fold s">

```{r eval = FALSE}
library(MASS)
data(survey)
help(survey)

str(survey)
#237 observations of 12 variables
#sex, wr.hnd, nw.hd, w.hnd, fold, pulse, clap, exer, smoke, height, M.I, age

survey$Sex
survey[[1]]
survey[,1]

head(survey)
tail(survey)

nrow(survey)
ncol(survey)

survey$Exer #3 options
freq <- subset(survey, survey$Exer == "Freq")

HeightTall <- subset(survey, survey$Height > 180)
#48 rows
```

</div>